
# SQL Master Cheat Sheet: Functions, Order & Constraints

## 1. Logical Execution Order
Understanding the order is critical to knowing **why** variables are available or unavailable in certain clauses.

| Step | Coding Order | Logical Execution Order | Description |
| :--- | :--- | :--- | :--- |
| 1 | `SELECT` | **FROM / JOIN** | Load tables and join datasets. |
| 2 | `FROM` | **WHERE** | Filter **raw rows** (before grouping). |
| 3 | `JOIN` | **GROUP BY** | Group rows into buckets. |
| 4 | `WHERE` | **HAVING** | Filter **aggregated groups**. |
| 5 | `GROUP BY` | **SELECT** | Compute expressions, Scalar functions, and **Window functions**. |
| 6 | `HAVING` | **DISTINCT** | Remove duplicate rows. |
| 7 | `ORDER BY` | **ORDER BY** | Sort the final result. |
| 8 | `LIMIT` | **LIMIT / TOP** | Limit the number of output rows. |

---

## 2. Constraints by Clause (What is allowed where?)

### A. WHERE Clause
*Used for filtering raw data.*

| Function Type | Status | Example |
| :--- | :--- | :--- |
| **Scalar Functions** | ‚úÖ **Allowed** | `WHERE YEAR(date_col) = 2023` |
| **NULL Handling** | ‚úÖ **Allowed** | `WHERE COALESCE(phone, 'No Phone') = 'No Phone'` |
| **Math/String** | ‚úÖ **Allowed** | `WHERE UPPER(status) = 'ACTIVE'` |
| **Aggregate Functions** | ‚ùå **FORBIDDEN** | **Wrong:** `WHERE SUM(amt) > 100` (Use `HAVING`) |
| **Window Functions** | ‚ùå **FORBIDDEN** | **Wrong:** `WHERE RANK() = 1` (Use CTE) |

### B. GROUP BY Clause
*Used for defining the buckets for aggregation.*

| Function Type | Status | Example |
| :--- | :--- | :--- |
| **Scalar Functions** | ‚úÖ **Allowed** | `GROUP BY DATE_TRUNC('month', order_date)` |
| **NULL Handling** | ‚úÖ **Allowed** | `GROUP BY COALESCE(region, 'Unknown')` |
| **Original Columns** | ‚úÖ **Allowed** | `GROUP BY department_id` |
| **Aggregate Functions** | ‚ùå **FORBIDDEN** | You cannot group by the result of a sum. |
| **Window Functions** | ‚ùå **FORBIDDEN** | Windowing happens after grouping. |

### C. HAVING Clause
*Used for filtering after grouping.*

| Function Type | Status | Example |
| :--- | :--- | :--- |
| **Aggregate Functions** | ‚úÖ **Main Use** | `HAVING SUM(revenue) > 10000` |
| **Scalar Functions** | ‚ö†Ô∏è **Conditional** | Only if wrapping an aggregate. `HAVING ROUND(AVG(score)) > 90` |
| **Grouping Columns** | ‚úÖ **Allowed** | `HAVING region = 'North'` (though usually done in WHERE) |
| **Raw Columns** | ‚ùå **FORBIDDEN** | Cannot use columns not present in GROUP BY unless aggregated. |

### D. SELECT Clause
*Used for calculating final output.*

| Function Type | Status | Example |
| :--- | :--- | :--- |
| **All Functions** | ‚úÖ **Allowed** | Scalar, Aggregate, Window, Math, String, Date ‚Äî all work here. |

---

## 3. The Complete Function Library
Here is a categorized list of functions so you know **what** tools you have.

### Category 1: Scalar Functions (Row-Level)
*Operates on a single row at a time. Returns one value for each row.*

#### üõ† NULL Handling (Crucial for Data Cleaning)
| Function | Description | Example |
| :--- | :--- | :--- |
| **`COALESCE(v1, v2, ...)`** | Returns the **first** non-null value in the list. | `COALESCE(phone_number, email, 'No Contact')` |
| **`NULLIF(v1, v2)`** | Returns `NULL` if v1 equals v2; otherwise returns v1. Used to avoid "Divide by Zero". | `price / NULLIF(qty, 0)` |
| **`ISNULL(v, replacement)`**| (SQL Server/MySQL) Replaces NULL with a value. | `ISNULL(price, 0)` |

#### üìÖ Date & Time Functions
| Function | Description | Example |
| :--- | :--- | :--- |
| **`CURRENT_DATE` / `GETDATE()`** | Returns today's date/time. | `WHERE order_date < CURRENT_DATE` |
| **`DATE_ADD(date, interval)`** | Adds time to a date. | `DATE_ADD(dt, INTERVAL 7 DAY)` |
| **`DATEDIFF(unit, d1, d2)`** | Difference between two dates. | `DATEDIFF(day, start_date, end_date)` |
| **`EXTRACT(part FROM date)`** | Pulls out year, month, day. | `EXTRACT(YEAR FROM order_date)` |
| **`DATE_TRUNC` / `FORMAT`** | Truncates date precision (e.g., to Month start). | `DATE_TRUNC('month', order_date)` |

#### üî° String Functions
| Function | Description | Example |
| :--- | :--- | :--- |
| **`CONCAT(s1, s2)`** | Joins strings together. | `CONCAT(first_name, ' ', last_name)` |
| **`UPPER()` / `LOWER()`** | Changes case. | `UPPER(email)` |
| **`SUBSTRING(s, start, len)`** | Extracts part of a string. | `SUBSTRING(sku, 1, 3)` |
| **`TRIM()`** | Removes leading/trailing spaces. | `TRIM(user_input)` |
| **`LENGTH()` / `LEN()`** | Returns string length. | `LENGTH(password)` |

#### üßÆ Math Functions
| Function | Description | Example |
| :--- | :--- | :--- |
| **`ROUND(num, decimals)`** | Rounds a number. | `ROUND(12.345, 2)` ‚Üí `12.35` |
| **`ABS(num)`** | Absolute value. | `ABS(-50)` ‚Üí `50` |
| **`CEILING()` / `FLOOR()`** | Force round up or down. | `CEILING(4.1)` ‚Üí `5` |
| **`CAST(val AS type)`** | Changes data type. | `CAST('2023-01-01' AS DATE)` |

#### üîÄ Logic
| Function | Description | Example |
| :--- | :--- | :--- |
| **`CASE WHEN`** | If-Then-Else logic. | `CASE WHEN age >= 18 THEN 'Adult' ELSE 'Minor' END` |

---

### Category 2: Aggregate Functions (Group-Level)
*Collapses multiple rows into one value. Usually requires `GROUP BY`.*

| Function | Use Case | Example |
| :--- | :--- | :--- |
| **`COUNT(*)`** | Count rows (including NULLs). | `COUNT(*)` |
| **`COUNT(col)`** | Count rows (ignoring NULLs in that column). | `COUNT(email)` |
| **`SUM(col)`** | Total of numeric column. | `SUM(revenue)` |
| **`AVG(col)`** | Average value. | `AVG(score)` |
| **`MIN(col)`** | Smallest number or **Earliest Date**. | `MIN(login_date)` |
| **`MAX(col)`** | Largest number or **Latest Date**. | `MAX(login_date)` |
| **`STRING_AGG` / `GROUP_CONCAT`** | Joins strings from a group into one list. | `STRING_AGG(tags, ', ')` |

---

### Category 3: Window Functions (Set-Level)
*Calculates across a set of rows but retains original rows. Requires `OVER()`.*

| Function | Use Case | Example |
| :--- | :--- | :--- |
| **`ROW_NUMBER()`** | Unique ID for sorting (1, 2, 3). | Deduplicating data. |
| **`RANK()`** | Ranking with skips (1, 1, 3). | Leaderboards. |
| **`DENSE_RANK()`** | Ranking without skips (1, 1, 2). | "Top N" queries. |
| **`LEAD(col)`** | Get value from **next** row. | Comparing vs Next Day. |
| **`LAG(col)`** | Get value from **previous** row. | Comparing vs Previous Day (MoM). |
| **`SUM(col) OVER(...)`** | Running Total. | Cumulative revenue. |

---

## 4. Cheat Sheet: When to use what?

| Scenario | Solution | Clause |
| :--- | :--- | :--- |
| "I want to replace NULLs with 0." | `COALESCE(col, 0)` | SELECT / WHERE |
| "I want to group by Month." | `GROUP BY DATE_TRUNC('month', date)` | GROUP BY |
| "I want to filter based on a Total Sum." | `HAVING SUM(col) > X` | HAVING |
| "I want the Top 3 items per category." | `ROW_NUMBER() OVER(...)` | SELECT (then filter in CTE) |
| "I want to avoid dividing by zero." | `col / NULLIF(divisor, 0)` | SELECT |
| "I want to label data based on conditions." | `CASE WHEN...` | SELECT |


